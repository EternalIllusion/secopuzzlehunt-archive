{
  "type": "problem",
  "title": "Bingo!",
  "extendData": "",
  "contentType": 1,
  "content": "{% block puzzle-body-html %}\n<style>\n    /* 容器：限制最大宽度，居中 */\n    .bingo-container {\n        margin: 20px auto;\n        padding: 20px;\n        box-shadow: 0 4px 15px rgba(0,0,0,0.1);\n        border-radius: 8px;\n    }\n\n    .bingo-image-wrapper { text-align: center; margin-bottom: 20px; }\n    .bingo-image { max-width: 100%; border-radius: 4px; }\n\n    /* 统一的网格系统 */\n    .unified-grid { \n        display: grid;\n        grid-template-columns: repeat(5, 1fr); /* 强制5列 */\n        gap: 0; /* 关键：无间距 */\n        width: 100%;\n        border: 2px solid #333; /* 整体外框 */\n        background-color: #333; /* 边框缝隙颜色 */\n    }\n\n    /* 通用格子样式 (谜题格 + 图例格) */\n    .grid-cell {\n        aspect-ratio: 1 / 1; /* 关键：严格正方形 */\n        position: relative;\n        display: flex;\n        justify-content: center;\n        align-items: center;\n        align-content: center;\n        flex-wrap: wrap; /* 允许内部字符换行 */\n        padding: 2px;\n        box-sizing: border-box;\n        /* 实现细线网格的技巧：利用 outline 或 border */\n        border: 1px solid rgba(0,0,0,0.15); \n        margin: 0; \n    }\n\n    /* 字符小方块容器 */\n    .char-content {\n        display: flex;\n        flex-wrap: wrap;\n        justify-content: center;\n        gap: 2px;\n        width: 100%;\n    }\n\n    /* 单个字符/黑块 */\n    .char-box {\n        width: 14px;\n        height: 14px;\n        display: flex;\n        justify-content: center;\n        align-items: center;\n        font-weight: bold;\n        line-height: 1;\n        user-select: none;\n    }\n\n    .black-square {\n        width: 100%;\n        height: 100%;\n        background-color: #000000;\n        border-radius: 1px;\n    }\n\n    /* 图例文字特殊样式 */\n    .legend-text {\n        font-weight: bold;\n        text-align: center;\n        line-height: 1.2;\n    }\n\n    /* 交互区 */\n    .interaction-area {\n        margin-top: 25px;\n        background: #f8f9fa;\n        padding: 15px;\n        border-radius: 8px;\n        text-align: center;\n        border: 1px solid #ddd;\n    }\n    \n    #bingo-input {\n        width: 80px;\n        text-align: center;\n        padding: 5px;\n        color: #000;\n    }\n    \n    .status-line { margin-top: 5px; font-size: 1.5rem; color: #666; }\n\n    /* 响应式调整：手机上字体和块更小 */\n    @media (max-width: 500px) {\n        .char-box { width: 10px; height: 10px; font-size: 10px; }\n        .grid-cell { font-size: 0.6rem; }\n        .legend-text { font-size: 0.7rem; }\n    }\n    /* 在你的 <style> 标签最后加入这个 */\n\n\t.cell {\n    /* 强制文字颜色为白色，!important 权重最高，可以覆盖网站默认样式 */\n    color: #8a8080 !important; \n    \n    /* 如果你需要让被遮挡的方块(█)也是白色，加上这句 */\n    /* 如果不想影响方块，只影响文字，可以去掉这句 */\n    -webkit-text-fill-color: #8a8080 !important; \n\t}\n\n/* 如果你的格子里面还有 span 标签（例如 masked 类），也强制变白 */\n\t.cell span, .cell .masked {\n    color: #8a8080 !important;\n\t}\n\n/* 针对侧边栏图例的文字 */\n\t.sidebar .cell {\n    color: #8a8080 !important;\n\t}\n\n    /* 猜测历史弹窗 */\n    .bingo-history-overlay {\n        position: fixed; top: 0; left: 0; width: 100%; height: 100%;\n        background: rgba(0,0,0,0.5); display: none; justify-content: center; align-items: center;\n        z-index: 1000;\n    }\n    .bingo-history-content {\n        background: #fff; padding: 24px; border-radius: 10px; max-width: 400px; width: 90%;\n        max-height: 70vh; overflow-y: auto; position: relative;\n    }\n    .bingo-history-close { position: absolute; top: 10px; right: 14px; font-size: 1.5rem; cursor: pointer; border: none; background: none; color: #666; }\n    .bingo-history-list { list-style: none; padding: 0; margin: 0; }\n    .bingo-history-list li { padding: 8px 0; border-bottom: 1px solid #eee; display: flex; justify-content: space-between; gap: 12px; }\n    .bingo-history-list li:last-child { border-bottom: none; }\n</style>\n\n<div class=\"bingo-container\">    <!-- 统一的 Grid 容器 -->\n    <div id=\"main-grid\" class=\"unified-grid\">\n        <!-- 1-25 谜题格子将在这里生成 -->\n    </div>\n    \n    <!-- 为了视觉区分，可以给图例和正文之间加一个分隔条，或者直接连着 -->\n    <!-- 如果要求完全没有区别，可以把图例直接追加到上面的 grid 里，或者紧贴着放 -->\n    <div id=\"legend-grid\" class=\"unified-grid\" style=\"border-top: none; margin-top: 0;\">\n        <!-- 图例格子将在这里生成 -->\n    </div>\n\n    <div class=\"interaction-area\">\n        <p>输入字符解锁面板：</p>\n        <div style=\"display: flex; justify-content: center; gap: 10px; align-items: center;\">\n            <input type=\"text\" id=\"bingo-input\" maxlength=\"1\" placeholder=\"?\" autocomplete=\"off\">\n            <button id=\"submit-btn\" class=\"btn btn-primary\">提交</button>\n            <span id=\"attempts-display\" style=\"font-weight: bold; color: #ff6600; min-width: 120px;\">剩余: 50 次</span>\n        </div>\n        <div id=\"feedback-display\" style=\"margin-top: 10px; font-weight: bold; min-height: 24px;\"></div>\n        <div class=\"status-line\">\n            已解锁字符: <span id=\"stats-unlocked\">0</span>\n        </div>\n        <div style=\"margin-top: 15px; text-align: center; display: flex; justify-content: center; gap: 10px; flex-wrap: wrap;\">\n            <button id=\"bingo-history-btn\" class=\"btn btn-secondary\">查看猜测历史</button>\n            <button id=\"exchange-hints-btn\" class=\"btn\" style=\"background-color: #4CAF50; color: white; padding: 8px 15px; border-radius: 4px; cursor: pointer;\">\n                用1个提示点换50次提交 →\n            </button>\n        </div>\n    </div>\n\n    <div class=\"bingo-history-overlay\" id=\"bingo-history-modal\">\n        <div class=\"bingo-history-content\">\n            <button type=\"button\" class=\"bingo-history-close\" id=\"bingo-history-close\" aria-label=\"关闭\">&times;</button>\n            <h3 style=\"margin-top: 0;\">猜测历史</h3>\n            <ul id=\"bingo-history-list\" class=\"bingo-history-list\"></ul>\n        </div>\n    </div>\n    \n    <div class=\"bingo-image-wrapper\">\n        <img id=\"bingo-main-image\" src=\"static/puzzle_resources/bingo/image.png\" alt=\"Puzzle Image\" class=\"bingo-image\" style=\"display: none;\">\n    </div>\n\n\n</div>\n\n<script>\ndocument.addEventListener('DOMContentLoaded', () => {\n    const mainGridEl = document.getElementById('main-grid');\n    const legendGridEl = document.getElementById('legend-grid');\n    const imageEl = document.getElementById('bingo-main-image');\n    const inputEl = document.getElementById('bingo-input');\n    const submitBtn = document.getElementById('submit-btn');\n    const exchangeBtn = document.getElementById('exchange-hints-btn');\n    const historyBtn = document.getElementById('bingo-history-btn');\n    const historyModal = document.getElementById('bingo-history-modal');\n    const historyCloseBtn = document.getElementById('bingo-history-close');\n    const historyListEl = document.getElementById('bingo-history-list');\n    const feedbackEl = document.getElementById('feedback-display');\n    const statsEl = document.getElementById('stats-unlocked');\n    const attemptsEl = document.getElementById('attempts-display');\n\n    const apiUrl = \"{% url 'bingo_api' %}\";\n    const csrfToken = \"{{ csrf_token }}\";\n\n    async function apiCall(data) {\n        try {\n            const response = await fetch(apiUrl, { \n                method: 'POST', \n                headers: { 'Content-Type': 'application/json', 'X-CSRFToken': csrfToken }, \n                body: JSON.stringify(data) \n            });\n            return await response.json();\n        } catch (error) {\n            return { success: false, message: '网络错误' };\n        }\n    }\n\n    // 渲染谜题格子 (显示黑块/字符)\n    function renderPuzzleCell(cell) {\n        const cellDiv = document.createElement('div');\n        cellDiv.className = 'grid-cell';\n        cellDiv.style.backgroundColor = cell.color;\n        if (cell.text_color) cellDiv.style.color = cell.text_color;\n        \n        const contentDiv = document.createElement('div');\n        contentDiv.className = 'char-content';\n\n        const blockColor = cell.text_color || '#000';\n        cell.display.forEach(charState => {\n            const charBox = document.createElement('div');\n            charBox.className = 'char-box';\n            if (charState.type === 'mask') {\n                const sq = document.createElement('div');\n                sq.className = 'black-square';\n                sq.style.backgroundColor = blockColor;\n                charBox.appendChild(sq);\n            } else {\n                charBox.innerText = charState.val;\n            }\n            contentDiv.appendChild(charBox);\n        });\n        \n        cellDiv.appendChild(contentDiv);\n        return cellDiv;\n    }\n\n    // 渲染图例格子 (显示纯文本标签)\n    function renderLegendCell(item) {\n        const cellDiv = document.createElement('div');\n        cellDiv.className = 'grid-cell';\n        cellDiv.style.backgroundColor = item.color;\n        if (item.text_color) cellDiv.style.color = item.text_color;\n        // 直接显示标签文字\n        cellDiv.innerHTML = `<span class=\"legend-text\">${item.label}</span>`;\n        return cellDiv;\n    }\n\n    function renderBoard(data) {\n        // 1. 渲染 5x5 谜题区\n        mainGridEl.innerHTML = '';\n        data.grid_data.forEach(cell => {\n            mainGridEl.appendChild(renderPuzzleCell(cell));\n        });\n\n        // 2. 渲染图例区 (同样是 5 列 Grid)\n        legendGridEl.innerHTML = '';\n        if (data.legend_data) {\n            data.legend_data.forEach(item => {\n                legendGridEl.appendChild(renderLegendCell(item));\n            });\n            \n            // 如果图例不足5个，补齐空白格子以保持布局对齐（可选）\n            const emptyCount = 5 - (data.legend_data.length % 5);\n            if (emptyCount < 5) {\n                for (let i = 0; i < emptyCount; i++) {\n                    const emptyCell = document.createElement('div');\n                    emptyCell.className = 'grid-cell';\n                    emptyCell.style.background = '#fff'; // 或透明\n                    emptyCell.style.border = '1px solid rgba(0,0,0,0.05)';\n                    legendGridEl.appendChild(emptyCell);\n                }\n            }\n        }\n    }\n\n    async function loadData() {\n        const res = await apiCall({ action: 'get_board_data' });\n        if (res.success) {\n            if (res.image_url) { imageEl.src = res.image_url; imageEl.style.display = 'inline-block'; }\n            renderBoard(res);\n            statsEl.innerText = res.stats.unlocked;\n            attemptsEl.innerText = `剩余: ${res.stats.attempts_left} 次`;\n        } else {\n            feedbackEl.innerText = \"加载失败: \" + res.message;\n        }\n    }\n\n    async function handleSubmit() {\n        const char = inputEl.value.trim();\n        if (!char) return;\n\n        inputEl.disabled = true;\n        submitBtn.disabled = true;\n        \n        const res = await apiCall({ action: 'submit_char', submission: char });\n\n        inputEl.disabled = false;\n        submitBtn.disabled = false;\n        inputEl.value = '';\n        inputEl.focus();\n\n        if (res.success) {\n            feedbackEl.innerText = res.message;\n            feedbackEl.style.color = res.result === 'correct' ? 'green' : (res.result === 'incorrect' ? 'red' : 'orange');\n            attemptsEl.innerText = `剩余: ${res.attempts_left} 次`;\n            if (res.result === 'correct') loadData();\n        } else {\n            feedbackEl.innerText = res.message;\n            feedbackEl.style.color = 'red';\n            if (res.attempts_left !== undefined) {\n                attemptsEl.innerText = `剩余: ${res.attempts_left} 次`;\n            }\n        }\n    }\n\n    function formatHistoryTime(ts) {\n        if (!ts) return '';\n        try {\n            const d = new Date(ts);\n            if (isNaN(d.getTime())) return ts;\n            return d.toLocaleString('zh-CN', { month: '2-digit', day: '2-digit', hour: '2-digit', minute: '2-digit', second: '2-digit' });\n        } catch (_) { return ts; }\n    }\n\n    async function showHistory() {\n        const res = await apiCall({ action: 'get_history' });\n        if (!res.success) {\n            feedbackEl.innerText = '获取历史失败: ' + (res.message || '');\n            return;\n        }\n        historyListEl.innerHTML = (res.history && res.history.length)\n            ? res.history.map(item => `<li><span><strong>${escapeHtml(item.submission || '')}</strong></span><span style=\"color:#666;\">${formatHistoryTime(item.timestamp)}</span></li>`).join('')\n            : '<li style=\"color:#888;\">暂无猜测记录</li>';\n        historyModal.style.display = 'flex';\n    }\n\n    function escapeHtml(s) {\n        const div = document.createElement('div');\n        div.textContent = s;\n        return div.innerHTML;\n    }\n\n    async function handleExchangeHints() {\n        // 显示确认弹框\n        if (!confirm('确定要用1个提示点换50次提交机会吗？')) {\n            return;\n        }\n\n        exchangeBtn.disabled = true;\n        feedbackEl.innerText = '处理中...';\n        \n        const res = await apiCall({ action: 'exchange_hints' });\n        \n        exchangeBtn.disabled = false;\n        \n        if (res.success) {\n            feedbackEl.innerText = res.message;\n            feedbackEl.style.color = 'green';\n            attemptsEl.innerText = `剩余: ${res.attempts_left} 次`;\n        } else {\n            feedbackEl.innerText = res.message;\n            feedbackEl.style.color = 'red';\n        }\n    }\n\n    historyCloseBtn.addEventListener('click', () => { historyModal.style.display = 'none'; });\n    historyModal.addEventListener('click', (e) => { if (e.target === historyModal) historyModal.style.display = 'none'; });\n    historyBtn.addEventListener('click', showHistory);\n\n    submitBtn.addEventListener('click', handleSubmit);\n    inputEl.addEventListener('keyup', (e) => { if (e.key === 'Enter') handleSubmit(); });\n    exchangeBtn.addEventListener('click', handleExchangeHints);\n\n    loadData();\n});\n</script>\n",
  "answer": "SPLIT PERSONALITY",
  "desc": "",
  "tips": [
    {
      "title": "我毫无头绪！ (3提示点)",
      "content": "这是对本比赛所有题目的汇总，目前还没有解锁的题不会干扰结果。"
    },
    {
      "title": "我应该用哪些词进行猜测？ (4提示点)",
      "content": "开赛前我们在比赛群发了一份问卷，你需要从群精华消息里面的词云图中选词猜测。如果你没有加群，请提交【缤果词云一】/【缤果词云二】/【缤果词云三】得到这三张词云图。"
    },
    {
      "title": "该如何使用右下角的白色格子？ (0提示点)",
      "content": "这个格子仅作为空位，和提取无关。"
    },
    {
      "title": "我填完bingo了，然后呢？ (6提示点)",
      "content": "注意到提取部分的每行都是bingo图的某一行或某一列（有可能是倒序），把它们进行二进制提取。"
    },
    {
      "title": "我一直提取不出合适的答案，是不是哪格的答案有问题？ (2提示点)",
      "content": "黑色底的四格答案分别是：1-4是，1-5否，2-4否，2-5否。"
    },
    {
      "title": "本题的答案是什么？ (80提示点)",
      "content": "SPLIT PERSONALITY。"
    }
  ],
  "additionalAnswers": [
    {
      "answer": "缤果词云一",
      "message": "<img src=\"https://image.secopuzzle.com/SECO2/Bingo/simples/1.png\" alt=\"词云1\" width=\"2718\" height=\"1496\">"
    },
    {
      "answer": "缤果词云二",
      "message": "<img src=\"https://image.secopuzzle.com/SECO2/Bingo/simples/2.png\" alt=\"词云2\" width=\"2718\" height=\"1496\">"
    },
    {
      "answer": "缤果词云三",
      "message": "<img src=\"https://image.secopuzzle.com/SECO2/Bingo/simples/3.png\" alt=\"词云3\" width=\"2718\" height=\"1496\">"
    }
  ],
  "links": [
    {
      "title": "索引页",
      "type": "index",
      "path": "seco2/index"
    },
    {
      "title": "庄园",
      "path": "/area/seco2/1",
      "pgid": 1
    },
    {
      "title": "沙海",
      "path": "/area/seco2/2",
      "pgid": 2
    },
    {
      "title": "高塔",
      "path": "/area/seco2/3",
      "pgid": 3
    },
    {
      "title": "花原",
      "path": "/area/seco2/4",
      "pgid": 4
    },
    {
      "title": "暗格",
      "path": "/area/seco2/5",
      "pgid": 5
    },
    {
      "title": "过渡",
      "path": "/area/seco2/6",
      "pgid": 6
    },
    {
      "title": "中心",
      "path": "/area/seco2/7",
      "pgid": 7
    },
    {
      "title": "FM",
      "path": "/area/seco2/8",
      "pgid": 8
    }
  ],
  "arealink": {
    "title": "中心",
    "path": "/area/seco2/7",
    "pgid": 7
  }
}