{
  "type": "problem",
  "title": "随蓝百练",
  "extendData": "",
  "contentType": 1,
  "content": "<style>\n    .suilan-container { max-width: 900px; margin: auto; padding: 20px; background-color: #f0f0f0; border-radius: 12px; }\n    .suilan-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; padding: 10px; background: #fff; border-radius: 8px; font-size: 1.2rem; flex-wrap: wrap; }\n    .suilan-header > * { margin: 5px 10px; }\n    .suilan-grid { display: grid; grid-template-columns: repeat(10, 1fr); gap: 10px; }\n    .suilan-item { display: flex; justify-content: center; align-items: center; height: 60px; font-size: 1.5rem; font-weight: bold; border-radius: 8px; cursor: pointer; transition: all 0.2s; user-select: none; }\n    .suilan-item:hover { transform: translateY(-3px); box-shadow: 0 4px 8px rgba(0,0,0,0.2); }\n    .item-locked { background-color: #a0a0a0; color: #666; cursor: not-allowed; }\n    .item-unlocked { background-color: #e0e0e0; color: #333; }\n    .item-solved { background-color: #4CAF50; color: white; }\n    .suilan-modal-overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background-color: rgba(0,0,0,0.6); display: none; z-index: 1000; }\n    .suilan-modal-content { position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%) scale(0.95); background-color: white; padding: 30px; border-radius: 10px; width: 90%; max-width: 700px; max-height: 90vh; display: flex; flex-direction: column; box-shadow: 0 5px 25px rgba(0,0,0,0.4); opacity: 0; transition: opacity 0.2s ease, transform 0.2s ease; }\n    .suilan-modal-close { position: absolute; top: 10px; right: 15px; font-size: 2rem; cursor: pointer; border: none; background: none; }\n    #suilan-modal-question { flex-grow: 1; overflow-y: auto; background: #f9f9f9; padding: 15px; border-radius: 5px; margin-bottom: 15px; white-space: pre-wrap; }\n    #suilan-answer-input { width: 100%; padding: 8px; margin: 10px 0; }\n</style>\n\n{# ======================================================= #}\n{#   2. HTML 结构 #}\n{# ======================================================= #}\n<div class=\"suilan-container\">\n    <div class=\"suilan-header\">\n        <h3>随蓝百练</h3>\n        <button id=\"exchange-hint-for-score-btn\" class=\"btn\">消耗1提示点换50积分</button>\n        <button id=\"unlock-extra-puzzle-btn\" class=\"btn\">消耗20积分解锁一题</button>\n        <div>当前积分: <b id=\"suilan-score\">{{ team.suilan_state.score|default:400 }}</b></div>\n    </div>\n    <div class=\"suilan-grid\">\n        {% for item_id, data in suilan_items %}\n            <div class=\"suilan-item item-{{ data.status }}\" data-item-id=\"{{ item_id }}\">\n                {{ item_id }}\n            </div>\n        {% endfor %}\n    </div>\n\n    <!-- 最终图片容器，图片URL从后端获取 -->\n    <div id=\"suilan-final-image-container\" style=\"display: none; text-align: center; margin-top: 20px;\">\n        <!-- 图片将在完成所有题目后动态加载 -->\n    </div>\n</div>\n\n{# 悬浮窗口 (结构修改) #}\n<div class=\"suilan-modal-overlay\" id=\"suilan-modal\">\n    <div class=\"suilan-modal-content\" id=\"suilan-modal-content\">\n        <button class=\"suilan-modal-close\" id=\"suilan-modal-close-btn\">&times;</button>\n        <h2 id=\"suilan-modal-title\">小题 </h2>\n        <div id=\"suilan-modal-question\">正在加载题目...</div>\n        \n        <!-- 【新增】用于显示已解答题目的答案 -->\n        <div id=\"suilan-modal-answer-section\" style=\"display: none;\">\n            <hr>\n            <h4>正确答案:</h4>\n            <p id=\"suilan-modal-answer\" style=\"font-weight: bold; color: green; font-size: 1.2rem;\"></p>\n        </div>\n\n        <!-- 【修改】将交互部分包裹起来，便于整体显隐 -->\n        <div id=\"suilan-modal-interactive-section\">\n            <hr>\n            <div id=\"suilan-hint-section\" style=\"display: flex; justify-content: space-between; align-items: center;\">\n                <button id=\"suilan-buy-hint-btn\" class=\"btn\">购买提示</button>\n                <button id=\"suilan-buy-attempt-btn\" class=\"btn\">购买提交次数 (50积分)</button> <!-- 修正按钮文本积分 -->\n            </div>\n            <hr>\n            <div>\n                <input type=\"text\" id=\"suilan-answer-input\" placeholder=\"输入答案\">\n                <button id=\"suilan-submit-btn\" class=\"btn\">提交</button>\n                <p>剩余提交次数: <span id=\"suilan-attempts-left\">0</span></p>\n                <p id=\"suilan-feedback\"></p>\n            </div>\n        </div>\n    </div>\n</div>\n\n{# ======================================================= #}\n{#   3. JavaScript 交互逻辑 #}\n{# ======================================================= #}\n<script>\ndocument.addEventListener('DOMContentLoaded', () => {\n    // --- DOM Elements ---\n    const gridItems = document.querySelectorAll('.suilan-item');\n    const modal = document.getElementById('suilan-modal');\n    const modalContent = document.getElementById('suilan-modal-content');\n    const closeModalBtn = document.getElementById('suilan-modal-close-btn');\n    const scoreDisplay = document.getElementById('suilan-score');\n    const modalTitle = document.getElementById('suilan-modal-title');\n    const modalQuestion = document.getElementById('suilan-modal-question');\n    const buyHintBtn = document.getElementById('suilan-buy-hint-btn');\n    const buyAttemptBtn = document.getElementById('suilan-buy-attempt-btn');\n    const answerInput = document.getElementById('suilan-answer-input');\n    const submitBtn = document.getElementById('suilan-submit-btn');\n    const attemptsLeftDisplay = document.getElementById('suilan-attempts-left');\n    const feedbackDisplay = document.getElementById('suilan-feedback');\n    const unlockExtraBtn = document.getElementById('unlock-extra-puzzle-btn');\n    const exchangeHintBtn = document.getElementById('exchange-hint-for-score-btn');\n    // 【新增】获取新增的DOM元素\n    const modalInteractiveSection = document.getElementById('suilan-modal-interactive-section');\n    const modalAnswerSection = document.getElementById('suilan-modal-answer-section');\n    const modalAnswerDisplay = document.getElementById('suilan-modal-answer');\n    const finalImageContainer = document.getElementById('suilan-final-image-container');\n\n    const apiUrl = \"{% url 'suilan_api' %}\";\n    const csrfToken = \"{{ csrf_token }}\";\n    let currentItemId = null;\n\n    function formatHintBalance(val) {\n        const num = Number(val);\n        if (Number.isNaN(num)) return val;\n        const truncated = Math.trunc(num * 100) / 100;\n        return truncated.toFixed(2);\n    }\n\n    // --- API 调用 (无改动) ---\n    async function apiCall(data) { try { const response = await fetch(apiUrl, { method: 'POST', headers: { 'Content-Type': 'application/json', 'X-CSRFToken': csrfToken }, body: JSON.stringify(data) }); return response.json(); } catch (error) { console.error('API call failed:', error); return { success: false, error: 'Network error' }; } }\n\n    // --- 弹窗控制 ---\n    async function openModal() {\n        modal.style.display = 'block';\n        requestAnimationFrame(() => {\n            modalContent.style.opacity = '1';\n            modalContent.style.transform = 'translate(-50%, -50%) scale(1)';\n        });\n        \n        const result = await apiCall({ action: 'get_data', item_id: currentItemId });\n\n        if (result.success) {\n            modalQuestion.innerText = result.question;\n            // 【修改】根据题目状态决定显示内容\n            if (result.status === 'solved') {\n                modalAnswerDisplay.innerText = result.answer;\n                modalAnswerSection.style.display = 'block';\n                modalInteractiveSection.style.display = 'none';\n            } else { // 'unlocked'\n                attemptsLeftDisplay.innerText = result.attempts_left;\n                if (result.can_buy_hint) {\n                    buyHintBtn.style.display = 'inline-block';\n                    buyHintBtn.innerText = `解锁下一段 (${result.next_hint_cost}积分)`;\n                } else {\n                    buyHintBtn.style.display = 'none';\n                }\n                const hasAttempts = result.attempts_left > 0;\n                submitBtn.disabled = !hasAttempts;\n                answerInput.disabled = !hasAttempts;\n                modalAnswerSection.style.display = 'none';\n                modalInteractiveSection.style.display = 'block';\n            }\n        } else {\n            modalQuestion.innerText = `加载失败: ${result.error}`;\n            modalInteractiveSection.style.display = 'none';\n        }\n    }\n\n    function closeModal() {\n        modalContent.style.opacity = '0';\n        modalContent.style.transform = 'translate(-50%, -50%) scale(0.95)';\n        setTimeout(() => { modal.style.display = 'none'; }, 200);\n    }\n\n    // --- 核心事件监听器 ---\n    gridItems.forEach(item => {\n        item.addEventListener('click', () => {\n            if (item.classList.contains('item-locked')) return;\n            currentItemId = item.dataset.itemId;\n            modalTitle.innerText = `小题 ${currentItemId}`;\n            // 重置弹窗状态\n            modalQuestion.innerText = '正在加载...';\n            feedbackDisplay.innerText = '';\n            answerInput.value = '';\n            openModal();\n        });\n    });\n    \n    closeModalBtn.addEventListener('click', closeModal);\n    modal.addEventListener('click', (e) => { if (e.target === modal) { closeModal(); } });\n\n    submitBtn.addEventListener('click', async () => { \n        const answer = answerInput.value; if (!answer) return;\n        feedbackDisplay.innerText = '正在提交...'; \n        const result = await apiCall({ action: 'submit', item_id: currentItemId, answer: answer }); \n        if (result.success) { \n            if (result.result === 'progress_reset') { alert(result.message); window.location.reload(); return; }\n            if (result.result === 'correct') { \n                feedbackDisplay.innerText = '回答正确！';\n                feedbackDisplay.style.color = 'green'; \n                document.querySelector(`.suilan-item[data-item-id='${result.item_id}']`)?.classList.replace('item-unlocked', 'item-solved');\n                if (result.newly_unlocked_id) { \n                    document.querySelector(`.suilan-item[data-item-id='${result.newly_unlocked_id}']`)?.classList.replace('item-locked', 'item-unlocked'); \n                } \n                if (result.show_final_image) {\n                    // 从后端返回的图片URL动态加载\n                    if (result.final_image_url) {\n                        const img = document.createElement('img');\n                        img.src = result.final_image_url;\n                        img.alt = 'Congratulations!';\n                        img.style.maxWidth = '100%';\n                        img.style.borderRadius = '10px';\n                        finalImageContainer.innerHTML = '';\n                        finalImageContainer.appendChild(img);\n                    }\n                    finalImageContainer.style.display = 'block';\n                }\n                setTimeout(closeModal, 1000); \n            } else { \n                feedbackDisplay.innerText = '回答错误，请再试一次。';\n                feedbackDisplay.style.color = 'red'; \n                attemptsLeftDisplay.innerText = result.attempts_left; \n                if (result.attempts_left <= 0) { \n                    submitBtn.disabled = true; \n                    answerInput.disabled = true; \n                } \n            } \n        } else { \n            feedbackDisplay.innerText = `提交失败: ${result.error}`; \n        } \n    });\n\n    buyHintBtn.addEventListener('click', async () => {\n        const result = await apiCall({ action: 'buy_hint', item_id: currentItemId });\n        if (result.success) {\n            modalQuestion.innerText = result.question;\n            attemptsLeftDisplay.innerText = result.attempts_left;\n            if (result.can_buy_hint) {\n                buyHintBtn.style.display = 'inline-block';\n                buyHintBtn.innerText = `解锁下一段 (${result.next_hint_cost}积分)`;\n            } else {\n                buyHintBtn.style.display = 'none';\n            }\n            scoreDisplay.innerText = result.current_score;\n        } else {\n            alert(`购买提示失败: ${result.error}`);\n        }\n    });\n\n    buyAttemptBtn.addEventListener('click', async () => {\n        const result = await apiCall({ action: 'buy_attempt', item_id: currentItemId });\n        if (result.success) {\n            attemptsLeftDisplay.innerText = result.new_attempts_left;\n            scoreDisplay.innerText = result.new_score;\n            if (result.new_attempts_left > 0) {\n                submitBtn.disabled = false;\n                answerInput.disabled = false;\n            }\n        } else {\n            alert(`购买失败: ${result.error}`);\n        }\n    });\n    \n    unlockExtraBtn.addEventListener('click', async () => {\n        if (!confirm('确定要花费20积分解锁一道新题吗？')) return;\n        const result = await apiCall({ action: 'unlock_extra_puzzle' });\n        if (result.success) {\n            scoreDisplay.innerText = result.new_score;\n            document.querySelector(`.suilan-item[data-item-id='${result.newly_unlocked_id}']`)?.classList.replace('item-locked', 'item-unlocked');\n            alert(`成功解锁第 ${result.newly_unlocked_id} 题！`);\n        } else {\n            alert(`解锁失败: ${result.error}`);\n        }\n    });\n\n    exchangeHintBtn.addEventListener('click', async () => {\n        if (!confirm('确定要消耗 1 个提示点来兑换 50 积分吗？')) return;\n        const result = await apiCall({ action: 'exchange_hint_for_score' });\n        if (result.success) {\n            scoreDisplay.innerText = result.new_score;\n            const hintBalance = formatHintBalance(result.new_hints_remaining);\n            alert(`${result.message}\\n您当前剩余 ${hintBalance} 个提示点。`);\n        } else {\n            alert(`兑换失败: ${result.error}`);\n        }\n    });\n    \n    async function checkAllUnlockedOnLoad() {\n        // 在页面上查找任何一个 class 包含 'item-locked' 的元素\n        const firstLockedItem = document.querySelector('.suilan-item.item-locked');\n        // 如果找不到 (firstLockedItem 为 null), 说明所有题目都已解锁\n        if (!firstLockedItem) {\n            // 从后端获取最终图片\n            const result = await apiCall({ action: 'get_final_image' });\n            if (result.success && result.final_image_url) {\n                const img = document.createElement('img');\n                img.src = result.final_image_url;\n                img.alt = 'Congratulations!';\n                img.style.maxWidth = '100%';\n                img.style.borderRadius = '10px';\n                finalImageContainer.innerHTML = '';\n                finalImageContainer.appendChild(img);\n                finalImageContainer.style.display = 'block';\n            }\n        }\n    }\n    \n    // 页面加载完成后立即执行检查\n    checkAllUnlockedOnLoad();\n});\n</script>\n<p><a href=\"/DMs\" class=\"btn\">进入站内信</a></p>\n",
  "answer": "ICEBOMB",
  "desc": "<font color=\"#808080\"><i>解谜太累？不如做点小题轻松一下！</i></font>",
  "tips": [
    {
      "title": "随蓝是什么题型？ (0提示点)",
      "content": "每道题描述了一个词，题干开头【】的内容是这个词的首字母和字数，如“随蓝”表示为【S2】。"
    },
    {
      "title": "我知道该怎么提取了，但是我得到的100个东西该怎么用？ (4提示点)",
      "content": "你可以关注第47题的答案，看看这100个东西在其中出现的顺序。"
    },
    {
      "title": "最后一步该怎么做？ (4提示点)",
      "content": "将你得到的99个东西每三个分为一组进行三进制提取，然后把得到的英文句子放到浏览器里搜索。"
    }
  ],
  "additionalAnswers": [
    {
      "answer": "in mc edu to combine four sodium acetate",
      "message": "这是本题的中间答案！"
    }
  ],
  "links": [
    {
      "title": "索引页",
      "type": "index",
      "path": "seco2/index"
    },
    {
      "title": "庄园",
      "path": "/area/seco2/1",
      "pgid": 1
    },
    {
      "title": "沙海",
      "path": "/area/seco2/2",
      "pgid": 2
    },
    {
      "title": "高塔",
      "path": "/area/seco2/3",
      "pgid": 3
    },
    {
      "title": "花原",
      "path": "/area/seco2/4",
      "pgid": 4
    },
    {
      "title": "暗格",
      "path": "/area/seco2/5",
      "pgid": 5
    },
    {
      "title": "过渡",
      "path": "/area/seco2/6",
      "pgid": 6
    },
    {
      "title": "中心",
      "path": "/area/seco2/7",
      "pgid": 7
    },
    {
      "title": "FM",
      "path": "/area/seco2/8",
      "pgid": 8
    }
  ],
  "arealink": {
    "title": "花原",
    "path": "/area/seco2/4",
    "pgid": 4
  }
}